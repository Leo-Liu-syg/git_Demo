// Project: TEST_FT64F0AX_USART.prj
// Device:  FT64F0AX
// Memory:  PROM=10Kx14, SRAM=1KB, EEPROM=128                             
// Description: ï¿½ï¿½ï¿½ï¿½ï¿½Ïµç·¢ï¿½ï¿½10ï¿½ï¿½ï¿½Ö·ï¿½ï¿½ï¿½È»ï¿½ï¿½È´ï¿½ï¿½ï¿½ï¿½ï¿?10ï¿½ï¿½ï¿½Ö½ï¿½ï¿½ï¿½ï¿½Ý£ï¿½Í¨ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö·ï¿½ï¿½Í½ï¿½ï¿½Õ£ï¿½
//
// RELEASE HISTORY
// VERSION DATE     DESCRIPTION
// 1.6        25-6-5        ï¿½Þ¸ï¿½ÏµÍ³Ê±ï¿½ï¿½Îª8MHzï¿½ï¿½Ê¹ï¿½ï¿½LVR
//                FT64F0A5  TSSOP20
//              -------------------
// NC----------|1(PA5)   	(PA4)20|-----------NC     
// TXIO--------|2(PA6)   	(PA3)19|-----------NC 
// RXIO--------|3(PA7)   	(PA2)18|-----------NC
// NC----------|4(PC0)   	(PA1)17|-----------NC
// NC----------|5(PC1)		(PA0)16|-----------NC	
// NC----------|6(PB7)		(PB0)15|-----------NC
// GND---------|7(GND)		(PB1)14|-----------NC
// NC----------|8(PB6)		(PB2)13|-----------NC
// VDD---------|9(VDD)		(PB3)12|-----------NC
// NC----------|10(PB5)		(PB4)11|-----------NC
//				-------------------
// 
//*********************************************************
#include	"SYSCFG.h";
#include 	"FT64F0AX.h";
#include 	"URAT_INITIAL.h";
#include 	"Delay.h";
//***********************ï¿½ê¶¨ï¿½ï¿½****************************
#define		uchar		unsigned char

//Variable definition
volatile char W_TMP  @ 0x70 ;//ÏµÍ³Õ¼ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
volatile char BSR_TMP  @ 0x71 ;//ÏµÍ³Õ¼ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
volatile	uchar		receivedata=0;
volatile	uchar		senddata=0;

volatile	uchar		toSend=0;
uchar		i=0;
uchar		mmm=0;

uchar 		send_flag = 0; // ï¿½Ø´ï¿½Ê¹ï¿½Ü±ï¿½Ö¾ï¿½ï¿½1ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½É£ï¿½ï¿½ï¿½Ò?ï¿½Ø´ï¿½ï¿½ï¿½0ï¿½ï¿½Î´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
uchar 		init_send_done = 0; // ï¿½Ïµï¿½ï¿½Ê¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½É±ï¿½Ö¾



void user_isr();//ï¿½Ã»ï¿½ï¿½Ð¶Ï³ï¿½ï¿½ò£¬²ï¿½ï¿½ï¿½É¾ï¿½ï¿½
//===========================================================
//Funtion nameï¿½ï¿½interrupt ISR
//parametersï¿½ï¿½ï¿½ï¿½
//returned valueï¿½ï¿½ï¿½ï¿½
//===========================================================
void interrupt ISR(void)
{
#asm;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	NOP;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
#endasm;//ÏµÍ³ï¿½ï¿½ï¿½Ã²ï¿½ï¿½ï¿½ï¿½ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½
	user_isr(); //ï¿½ï¿½ï¿½ï¿½ï¿½Ã»ï¿½ï¿½Ð¶Ïºï¿½ï¿½ï¿½
}
void user_isr() //ï¿½ï¿½ï¿½ï¿½ï¿½Ã»ï¿½ï¿½Ð¶Ïºï¿½ï¿½ï¿½
{
    //ï¿½ï¿½ï¿½ï¿½ï¿½Ð¶ï¿½
   if(UR1RXNEF)	//½ÓÊÕbuf·Ç¿Õ	¡£Ó²¼þÖÃ1
    {
        UR1RXNEF = 0; // ï¿½ï¿½ï¿½ï¿½ï¿½Ö¾ï¿½ï¿½ï¿½Ù¶ï¿½ï¿½ï¿½ï¿½Ý£ï¿½ï¿½Å¾ï¿½Î±ï¿½Ð¶Ï£ï¿?
        receivedata = UR1DATAL; // ï¿½ï¿½È¡ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
        PORTB=receivedata;
        send_flag = 1; // ï¿½Ã»Ø´ï¿½ï¿½ï¿½Ö¾
       
    }
    
	 if(UR1TCEN && UR1TCF)			
    {
       
        if(send_flag == 1) 
        {
            UR1DATAL = receivedata; // ï¿½Ø´ï¿½ï¿½Ö·ï¿½
            send_flag = 0; // ï¿½ï¿½Î»ï¿½ï¿½Ö¾ï¿½ï¿½ï¿½È´ï¿½ï¿½ï¿½Ò»ï¿½Î½ï¿½ï¿½ï¿½
        }
         UR1TCF = 0; 
         	
    }
}

/*-------------------------------------------------
 * ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½POWER_INITIAL
 * ï¿½ï¿½ï¿½Ü£ï¿½  ï¿½Ïµï¿½ÏµÍ³ï¿½ï¿½Ê¼ï¿½ï¿½
 * ï¿½ï¿½ï¿½ë£º  ï¿½ï¿½
 * ï¿½ï¿½ï¿½ï¿½ï¿?  ï¿½ï¿½
 --------------------------------------------------*/
 void POWER_INITIAL(void)
 {
	OSCCON=0B01110001;			//ÏµÍ³Ê±ï¿½ï¿½Ñ¡ï¿½ï¿½Îªï¿½Ú²ï¿½ï¿½ï¿½ï¿½ï¿½8MHz,ï¿½ï¿½Æµï¿½ï¿½Îª1:1
    
	INTCON=0;					//ï¿½ï¿½Ö¹ï¿½ï¿½ï¿½ï¿½ï¿½Ð¶ï¿½
    
    PORTA=0B00000000;
    PORTB=0B00000000;
    PORTC=0B00000000;
    
	WPUA=0B00000000;			//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä¿ï¿½ï¿½Ø£ï¿½0-ï¿½Ø£ï¿½1-ï¿½ï¿½		
	WPUB=0B00000000;
	WPUC=0B00000000;	

	WPDA=0B00000000;			//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä¿ï¿½ï¿½Ø£ï¿½0-ï¿½Ø£ï¿½1-ï¿½ï¿½
	WPDB=0B00000000;
	WPDC=0B00000000;
	
	TRISA=0B10000000;			//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ã£ï¿?0-ï¿½ï¿½ï¿½ï¿½ï¿?1-ï¿½ï¿½ï¿½ï¿½
	TRISB=0B00000000;	
	TRISC=0B00000000;

	PSRC0=0B11111111;			//Ô´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿?
	PSRC1=0B11111111;
	PSRC2=0B00001111;

	PSINK0=0B11111111;			//ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
	PSINK1=0B11111111;
	PSINK2=0B00000011;

	ANSELA=0B00000000;			//ï¿½ï¿½ï¿½Ã¶ï¿½Ó¦ï¿½ï¿½IOÎªï¿½ï¿½ï¿½ï¿½IO	
 }
/*-------------------------------------------------
 * ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Delay10Us
 * ï¿½ï¿½ï¿½Ü£ï¿½  ï¿½ï¿½ï¿½ï¿½Ê±ï¿½ï¿½ï¿½ï¿½
 * ï¿½ï¿½ï¿½ë£º  ï¿½ï¿½
 * ï¿½ï¿½ï¿½ï¿½ï¿?  ï¿½ï¿½
 --------------------------------------------------*/
   
/*-------------------------------------------------
 * ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½DelayMs
 * ï¿½ï¿½ï¿½Ü£ï¿½  ï¿½ï¿½ï¿½ï¿½Ê±ï¿½ï¿½ï¿½ï¿½
 * ï¿½ï¿½ï¿½ë£º  Timeï¿½ï¿½Ê±Ê±ï¿½ä³¤ï¿½ï¿½ ï¿½ï¿½Ê±Ê±ï¿½ï¿½Time ms
 * ï¿½ï¿½ï¿½ï¿½ï¿?  ï¿½ï¿½
 --------------------------------------------------*/
 
 /*-------------------------------------------------
 * ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½UART_INITIAL
 * ï¿½ï¿½ï¿½Ü£ï¿½  ï¿½ï¿½Ê¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
 * ï¿½ï¿½ï¿½ë£º  ï¿½ï¿½
 * ï¿½ï¿½ï¿½ï¿½ï¿?  ï¿½ï¿½
 --------------------------------------------------*/

/*-------------------------------------------------
 * ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½main
 * ï¿½ï¿½ï¿½Ü£ï¿½  ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ 
 * ï¿½ï¿½ï¿½ë£º  ï¿½ï¿½
 * ï¿½ï¿½ï¿½ï¿½ï¿?  ï¿½ï¿½
 --------------------------------------------------*/
void main(void)
{
    POWER_INITIAL();			//ÏµÍ³ï¿½ï¿½Ê¼ï¿½ï¿½
    UART_INITIAL();
    DelayMs(100);
    
    //if(UR1TXEF && init_send_done == 0)
//    {
//        UR1DATAL = toSend; // ï¿½ï¿½ï¿½Íµï¿½Ò»ï¿½ï¿½ï¿½Ö·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ð¶ï¿½
//    }
    UR1TCEN = 0;
    while (1)
	{		
		DelayMs(10);
	}
}